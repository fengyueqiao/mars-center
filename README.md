# mars-center
用户统一管理服务的部署、启动、停止、状态监控
# 设计背景
- nacos实现了注册中心，配置中心。提供注册发现、动态配置功能
- sentinel实现了服务流量控制、熔断降级、系统负载保护
- dubbo实现了服务直接的rpc调用
对于一套完整微服务平台，缺少统一的服务发布，服务管理的功能。
当然可以基于Docker的的k8s可以实现服务的编排和部署。
但是，对于中小型的业务场景，引入容器套件又显得有些过重，目前没有特别好的替代方案。
# 设计目的
- 针对没有太多专业知识便可以使用
- 提供应用的统一部署和管理

# 功能描述
## 服务发布
- 服务安装包上传和下载
- 发布服务安装包到节点指定路径
- 在节点上构建程序的执行目录
- maven插件，可以执行命令直接发布并重启
## 版本控制
- 服务安装包历史版本管理
- 服务回滚到历史版本
## 服务控制
- 服务启动
- 服务关闭
- 服务重启
## 节点管理
- 节点状态同步
## 操作日志
- 操作日志记录
- 操作日志查询
## 用户和权限管理

# 系统设计
## 组件
- mars-center
作为管理中心对外提供统一接口，作为中心节点应用管理和节点状态，管理应用的发布版本。
- mars-node
作为某台服务器的管理服务，负责运行在该管理服务器上的应用实例的状态监控，完成实际的部署操作和管理指令。

## 关键问题
###mars与CI/CD工具有什么区别？
CI/CD（自动化构建、部署）是指一个集构建、发布、部署为一体的综合性工具。虽然自动化程度很高，但整个系统使用和维护成本比较高。
另外，对于为第三方客户提供服务部署时，通常是以安装包的形式提供，没有必要搞一套CI/CD环境。
mars目标是提供一套轻量级，低门槛，相对灵活的服务部署和管理集成套件。

###mars与zabbix之类的运维工具的区别
zabbix有很强的监控功能，支持操作系统、应用服务、中间件等各种监控只有专业的运维人员才能够使用和读懂这些参数。
mars只有基础服务监控功能，比如查看当前服务状态和进程id，提供一目了然的状态，主要针对小白用户。

### Node主动连接Center上报，还是center查询各个Node的状态
- Node节点重启，Node要能够知道当前节点上有哪些应用，应用的信息和状态，并能够自动将这些应用启动  
方案一，Node节点启动后主动连接Center获取该节点的服务信息，通过对应目录的启动脚本启动服务。  
方案二，读取所在应用的目录，从中获取应用信息，并自动启动。
方案一问题，若Center服务无法访问，可能导致无法获取服务信息，进而服务无法启动。  
方案二问题，若服务的设置的状态已经发生变化，但仍然按照之前设置的状态，启动了服务，可能导致不该启动的服务被启动了。  
权衡后选择  
Node节点启动，还是应该要从Center中获取到最新状态才能启动服务，否则可能会到导致服务版本错误，因为应用服务的问题。

- 通信效率
Center是相对稳定的，而Node可能会加入和退出。  
轮询的方式无论从及时性还是性能都比主动上报差。所以应该选择主动上报。

### Center和Node之间的交互消息
- Node => Center Node主动上报状态，包括节点信息和应用的状态
- Node => Center Node服务启动后会从Center拉取，运行在该节点的应用信息
- Center => Node App发布、启动、停止
